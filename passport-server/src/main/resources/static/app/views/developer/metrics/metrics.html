<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-8">
        <h2>Metrics</h2>
    </div>
    <div class="col-lg-4">
        <div class="title-action">
            <button type="button" class="btn btn-primary btn-sm pull-right" ng-click="vm.refresh()">
                <span class="fa fa-refresh"></span>&nbsp;
                <span>Refresh</span>
            </button>
        </div>
    </div>
</div>
<div class="wrapper wrapper-content p-h-xs animated fadeInDown">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox m-b-sm">
                <div class="ibox-content">
                    <div>
                        <h3>JVM status</h3>
                    </div>
                    <hr>
                    <div class="row" ng-hide="vm.updatingMetrics">
                        <div class="col-lg-2">
                            <h5 class="text-center">Total Memory</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.totalMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.memory.total.used'].value / 1000000 | number:0}}M / {{vm.metrics.gauges['jvm.memory.total.max'].value / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <h5 class="text-center">Heap Memory</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.heapMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.memory.heap.used'].value / 1000000 | number:0}}M / {{vm.metrics.gauges['jvm.memory.heap.max'].value / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <h5 class="text-center">Eden Space</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.edenSpaceMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.edenSpaceUsed / 1000000 | number:0}}M / {{vm.edenSpaceMax / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <h5 class="text-center">Survivor Space</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.survivorSpaceMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.survivorSpaceUsed / 1000000 | number:0}}M / {{vm.survivorSpaceMax / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <h5 class="text-center">Old Space</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.oldSpaceMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.oldGenUsed / 1000000 | number:0}}M / {{vm.oldGenMax / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <h5 class="text-center">Non-Heap Memory</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.nonHeapMemory" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.memory.non-heap.used'].value / 1000000 | number:0}}M / {{vm.metrics.gauges['jvm.memory.non-heap.committed'].value / 1000000 | number:0}}M
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="well well-lg" ng-show="vm.updatingMetrics">Updating...</div>
                </div>
            </div>
            <div class="ibox m-b-sm">
                <div class="ibox-content">
                    <h3>Garbage collections</h3>
                    <hr>
                    <div class="row" ng-hide="vm.updatingMetrics">
                        <div class="col-md-12">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Mark Sweep count</th>
                                    <th>Mark Sweep time(ms)</th>
                                    <th>Scavenge count</th>
                                    <th>Scavenge time(ms)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>{{vm.markSweepCount}}</td>
                                    <td>{{vm.markSweepTime}}</td>
                                    <td>{{vm.scavengeCount}}</td>
                                    <td>{{vm.scavengeTime}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="well well-lg" ng-show="vm.updatingMetrics">Updating...</div>
                </div>
            </div>
            <div class="ibox m-b-sm">
                <div class="ibox-content">
                    <p>
                        <button type="button" class="btn btn-primary btn-sm pull-right" ng-click="vm.refreshThreadDumpData()">
                            <span class="fa fa-eye"></span>&nbsp;
                            <span>Threads dump</span>
                        </button>
                    </p>
                    <div>
                        <h3>Threads</h3>
                    </div>
                    <hr>
                    <div class="row" ng-hide="vm.updatingMetrics">
                        <div class="col-lg-3">
                            <h5 class="text-center">Runnable</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.runnableThreads" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.threads.runnable.count'].value | number:0}} / {{vm.metrics.gauges['jvm.threads.count'].value | number:0}}
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <h5 class="text-center">Timed Waiting</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.timedWaitingThreads" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.threads.timed_waiting.count'].value | number:0}} / {{vm.metrics.gauges['jvm.threads.count'].value | number:0}}
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <h5 class="text-center">Waiting</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.waitingThreads" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.threads.waiting.count'].value | number:0}} / {{vm.metrics.gauges['jvm.threads.count'].value | number:0}}
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <h5 class="text-center">Blocked</h5>
                            <div>
                                <canvas doughnutchart options="vm.doughnutOptions" data="vm.blockedThreads" responsive=true></canvas>
                            </div>
                            <div class="text-center">
                                <p>
                                    {{vm.metrics.gauges['jvm.threads.blocked.count'].value | number:0}} / {{vm.metrics.gauges['jvm.threads.count'].value | number:0}}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="well well-lg" ng-show="vm.updatingMetrics">Updating...</div>
                </div>
            </div>
            <div class="ibox m-b-sm">
                <div class="ibox-content">
                    <h3>HTTP requests</h3>
                    <hr>
                    <p><span>Active requests</span> <b>{{vm.metrics.counters['com.codahale.metrics.servlet.InstrumentedFilter.activeRequests'].count | number:0}}</b> - <span>Total requests</span> <b>{{vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count | number:0}}</b></p>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Code</th>
                                <th>Count</th>
                                <th class="text-right">Average rate(counts/second)</th>
                                <th class="text-right">M1 rate(counts/second)</th>
                                <th class="text-right">M5 rate(counts/second)</th>
                                <th class="text-right">M15 rate(counts/second)</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>OK</td>
                                <td>
                                    <uib-progressbar min="0" max="vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count" value="vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].count" class="progress-striped active" type="primary">
                                        <span>{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].count}}</span>
                                    </uib-progressbar>
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].mean_rate | number:2}}
                                </td>
                                <td class="text-right">{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].m1_rate | number:2}}
                                </td>
                                <td class="text-right">{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].m5_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.ok'].m15_rate | number:2}}
                                </td>
                            </tr>
                            <tr>
                                <td>Not Found</td>
                                <td>
                                    <uib-progressbar min="0" max="vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count" value="vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].count" class="progress-striped active" type="primary">
                                        <span>{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].count}}</span>
                                    </uib-progressbar>
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].mean_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].m1_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].m5_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.notFound'].m15_rate | number:2}}
                                </td>
                            </tr>
                            <tr>
                                <td>Server error</td>
                                <td>
                                    <uib-progressbar min="0" max="vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count" value="vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].count" class="progress-striped active" type="primary">
                                        <span>{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].count}}</span>
                                    </uib-progressbar>
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].mean_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].m1_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].m5_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.serverError'].m15_rate | number:2}}
                                </td>
                            </tr>
                            <tr>
                                <td>Bad request</td>
                                <td>
                                    <uib-progressbar min="0" max="vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count" value="vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].count" class="progress-striped active" type="primary">
                                        <span>{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].count}}</span>
                                    </uib-progressbar>
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].mean_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].m1_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].m5_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.responseCodes.badRequest'].m15_rate | number:2}}
                                </td>
                            </tr>
                            <tr>
                                <td>Timeout</td>
                                <td>
                                    <uib-progressbar min="0" max="vm.metrics.timers['com.codahale.metrics.servlet.InstrumentedFilter.requests'].count" value="vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].count" class="progress-striped active" type="primary">
                                        <span>{{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].count}}</span>
                                    </uib-progressbar>
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].mean_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].m1_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].m5_rate | number:2}}
                                </td>
                                <td class="text-right">
                                    {{vm.metrics.meters['com.codahale.metrics.servlet.InstrumentedFilter.timeouts'].m15_rate | number:2}}
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <p>
                        <span class="fa fa-exclamation-circle" aria-hidden="true"></span>
                        <small>M1: every minute, M5: every five minutes, M15: every fifteen minutes</small>
                    </p>
                </div>
            </div>
            <div class="ibox m-b-sm">
                <div class="ibox-content">
                    <h3>HTTP responses & service results</h3>
                    <hr>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Service name</th>
                                <th class="text-right">Count</th>
                                <th class="text-right">Mean(ms)</th>
                                <th class="text-right">Min(ms)</th>
                                <th class="text-right">p50(ms)</th>
                                <th class="text-right">p75(ms)</th>
                                <th class="text-right">p99(ms)</th>
                                <th class="text-right">Max(ms)</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="(k, v) in vm.servicesStats">
                                <td>{{k}}</td>
                                <td class="text-right">{{v.count}}</td>
                                <td class="text-right">
                                    <span class="label label-primary" ng-show="v.mean * 1000 < 50">{{v.mean * 1000 | number:0}}</span>
                                    <span class="label label-warning" ng-show="v.mean * 1000 >= 50 && v.mean * 1000 < 1000">{{v.mean * 1000 | number:0}}</span>
                                    <span class="label label-danger" ng-show="v.mean * 1000 >= 1000">{{v.mean * 1000 | number:0}}</span>
                                </td>
                                <td class="text-right">{{v.min * 1000 | number:0}}</td>
                                <td class="text-right">{{v.p50 * 1000 | number:0}}</td>
                                <td class="text-right">{{v.p75 * 1000 | number:0}}</td>
                                <td class="text-right">{{v.p99 * 1000 | number:0}}</td>
                                <td class="text-right">{{v.max * 1000 | number:0}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="ibox m-b-sm hide">
                <div class="ibox-content">
                    <h3 ng-show="vm.metrics.gauges['HikariPool-1.pool.TotalConnections'].value > 0">DataSource statistics (time in milliseconds)</h3>
                    <hr>
                    <div class="table-responsive" ng-show="vm.metrics.gauges['HikariPool-1.pool.TotalConnections'].value > 0">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th><span>Usage</span> ({{vm.metrics.gauges['HikariPool-1.pool.ActiveConnections'].value}} / {{vm.metrics.gauges['HikariPool-1.pool.TotalConnections'].value}})</th>
                                <th class="text-right">Count</th>
                                <th class="text-right">Mean</th>
                                <th class="text-right">Min</th>
                                <th class="text-right">p50</th>
                                <th class="text-right">p75</th>
                                <th class="text-right">p99</th>
                                <th class="text-right">Max</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <div class="progress progress-striped">
                                        <uib-progressbar min="0" max="vm.metrics.gauges['HikariPool-1.pool.TotalConnections'].value" value="vm.metrics.gauges['HikariPool-1.pool.ActiveConnections'].value" class="progress-striped active" type="primary">
                                            <span>{{vm.metrics.gauges['HikariPool-1.pool.ActiveConnections'].value * 100 / vm.metrics.gauges['HikariPool-1.pool.TotalConnections'].value  | number:0}}%</span>
                                        </uib-progressbar>
                                    </div>
                                </td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].count}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].mean | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].min | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].p50 | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].p75 | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].p95 | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].p99 | number:2}}</td>
                                <td class="text-right">{{vm.metrics.histograms['HikariPool-1.pool.Usage'].max | number:2}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>